{% extends 'base.html' %}

{% block content %}
<h1>{{ post.title }}</h1>
<p>Publicado por {{ post.profile.user.username }} el {{ post.created_at|date:"d M Y H:i" }}</p>

{% if post.image %}
  <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width:400px;">
{% endif %}

<p>{{ post.content }}</p>

{% if post.profile == user.profile %}
  <a href="{% url 'post_edit' post.pk %}">Editar</a>
  <a href="{% url 'post_delete' post.pk %}">Eliminar</a>
{% endif %}

<a href="{% url 'post_list' %}">Volver a la lista</a>

<hr>

<h3>Comentarios</h3>

<div class="comments-section">

    {% for comment in post.comments.all %}
        {% if not comment.parent %}
            {% include "comments/comment_item.html" with comment=comment %}
        {% endif %}
    {% empty %}
        <p>No hay comentarios.</p>
    {% endfor %}

</div>

<hr>

{% if user.is_authenticated %}
<h4>Agregar comentario</h4>

<form method="POST" action="{% url 'add_comment' post.id %}">
    {% csrf_token %}
    <textarea name="content" rows="3" placeholder="Escribe un comentario..." required></textarea>
    <input type="hidden" name="parent_id" id="parent_id">
    <br>
    <button type="submit">Comentar</button>
</form>

{% else %}
<p><a href="{% url 'login' %}">Inicia sesi√≥n</a> para comentar.</p>
{% endif %}

{% endblock %}